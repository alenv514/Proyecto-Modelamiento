CREATE DATABASE IF NOT EXISTS appmodel;
USE appmodel;

CREATE TABLE IF NOT EXISTS tipos_usuario (
    ID_TIP INT AUTO_INCREMENT PRIMARY KEY,
    nombre_tipo VARCHAR(20) NOT NULL UNIQUE
);

INSERT IGNORE INTO tipos_usuario (nombre_tipo) VALUES
('ADMIN'),
('MODERADOR'),
('USUARIO');

CREATE TABLE IF NOT EXISTS usuarios (
    ID_USU INT AUTO_INCREMENT PRIMARY KEY,
    NIC_USU VARCHAR(30) NOT NULL UNIQUE,
    NOM_USU VARCHAR(50) NOT NULL,
    APE_USU VARCHAR(50) NOT NULL,
    COR_USU VARCHAR(100) NOT NULL,
    FEC_NAC_USU DATE NOT NULL,
    TEL_USU VARCHAR(10) NOT NULL,
    CON_USU VARCHAR(100) NOT NULL,
    ID_TIP_USU INT NOT NULL,
    FOREIGN KEY (ID_TIP_USU) REFERENCES tipos_usuario(ID_TIP),
    EST_USU ENUM('L','B') DEFAULT 'L',
    FEC_BAN_USU DATETIME DEFAULT NULL
);

CREATE TABLE IF NOT EXISTS PRODUCTOS (
    ID_PRO INT AUTO_INCREMENT PRIMARY KEY,
    NOM_PRO VARCHAR(50) NOT NULL,
    DES_PRO VARCHAR(255) NOT NULL,
    PRECIO DECIMAL(10,2) NOT NULL,
    ID_USUARIO INT NOT NULL,
    FOREIGN KEY (ID_USUARIO) REFERENCES usuarios(ID_USU)
);

CREATE TABLE IF NOT EXISTS IMAGENES_PRODUCTOS (
    ID_IMG INT AUTO_INCREMENT PRIMARY KEY,
    URL_IMG VARCHAR(255) NOT NULL,
    ID_PRO_PER INT NOT NULL,
    FOREIGN KEY (ID_PRO_PER) REFERENCES PRODUCTOS(ID_PRO)
);



INSERT IGNORE INTO usuarios (NIC_USU, NOM_USU, APE_USU, COR_USU, FEC_NAC_USU, TEL_USU, CON_USU, ID_TIP_USU, EST_USU, FEC_BAN_USU)
VALUES 
('admin', 'Admin', 'Principal', 'admin1234@gmail.com', '1990-01-01', '0999999999', 'ADMIN12345', 1, 'L', NULL);

CREATE TABLE IF NOT EXISTS CHATS (
    ID_CHAT INT AUTO_INCREMENT PRIMARY KEY,
    ID_PRODUCTO INT NOT NULL,
    ID_COMPRADOR INT NOT NULL,
    ID_VENDEDOR INT NOT NULL,
    FECHA_INICIO DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(ID_PRO),
    FOREIGN KEY (ID_COMPRADOR) REFERENCES usuarios(ID_USU),
    FOREIGN KEY (ID_VENDEDOR) REFERENCES usuarios(ID_USU)
);

CREATE TABLE IF NOT EXISTS MENSAJES (
    ID_MSJ INT AUTO_INCREMENT PRIMARY KEY,
    ID_CHAT INT NOT NULL,
    ID_REMITENTE INT NOT NULL,
    MENSAJE TEXT NOT NULL,
    FECHA_ENVIO DATETIME DEFAULT CURRENT_TIMESTAMP,
    LEIDO BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (ID_CHAT) REFERENCES CHATS(ID_CHAT),
    FOREIGN KEY (ID_REMITENTE) REFERENCES usuarios(ID_USU)
);

